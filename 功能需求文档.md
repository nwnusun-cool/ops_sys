# OpenStack运维管理平台 - 功能需求文档

## 📋 项目概述

### 项目目标
构建一个统一的OpenStack多集群管理平台，为运维人员提供简单易用的Web界面，实现对多个OpenStack环境的集中管理和监控。

### 核心价值
- **统一管理**：一个平台管理多个OpenStack集群
- **操作简化**：提供直观的Web界面，降低操作门槛  
- **安全可控**：完整的权限管理和操作审计
- **高效运维**：批量操作和自动化支持

## 🎯 功能模块详细需求

### 1. 用户认证与权限管理模块

#### 1.1 用户管理
**功能描述**：管理平台用户账户和基本信息

**详细需求**：
- [ ] **用户注册**
  - 管理员可创建新用户账户
  - 必填字段：用户名、邮箱、初始密码、角色
  - 支持用户状态管理（启用/禁用）
  
- [ ] **用户登录**
  - 用户名/邮箱 + 密码登录
  - 记住登录状态（30天）
  - 登录失败次数限制（5次锁定10分钟）
  
- [ ] **密码管理**
  - 修改密码（需验证原密码）
  - 管理员重置密码
  - 密码强度要求：至少8位，包含字母数字

- [ ] **用户信息管理**
  - 查看/编辑个人信息
  - 用户列表管理（管理员）
  - 用户操作日志查询

#### 1.2 角色权限
**功能描述**：基于角色的权限控制系统

**角色定义**：
- **超级管理员**：所有权限
- **管理员**：除用户管理外的所有权限
- **操作员**：可执行实例/卷的增删改操作
- **查看者**：只能查看信息，不能执行操作

**权限矩阵**：
| 功能模块 | 超级管理员 | 管理员 | 操作员 | 查看者 |
|---------|-----------|--------|--------|--------|
| 用户管理 | ✅ | ❌ | ❌ | ❌ |
| 集群管理 | ✅ | ✅ | ❌ | ❌ |
| 实例管理 | ✅ | ✅ | ✅ | 查看 |
| 卷管理 | ✅ | ✅ | ✅ | 查看 |
| 网络管理 | ✅ | ✅ | ✅ | 查看 |
| 快照管理 | ✅ | ✅ | ✅ | 查看 |
| SSH管理 | ✅ | ✅ | ✅ | 查看 |
| 系统设置 | ✅ | ✅ | ❌ | ❌ |

### 2. OpenStack集群管理模块

#### 2.1 集群配置
**功能描述**：管理多个OpenStack环境的连接配置

**详细需求**：
- [ ] **集群添加**
  - 集群名称、描述
  - 认证信息：auth_url, username, password, project等
  - 连接测试功能
  - 配置信息加密存储

- [ ] **集群管理**
  - 集群列表展示（状态、延迟、版本信息）
  - 编辑集群配置
  - 启用/禁用集群
  - 删除集群（需确认）

- [ ] **集群监控**
  - 连接状态实时检测
  - API响应时间监控
  - 集群资源概览（实例数、卷数等）

#### 2.2 集群切换
- [ ] **环境切换**
  - 顶部下拉菜单选择集群
  - 记住用户最后选择的集群
  - 支持多集群对比视图

### 3. OpenStack实例管理模块

#### 3.1 实例列表
**功能描述**：展示和管理虚拟机实例

**详细需求**：
- [ ] **列表展示**
  ```
  字段：实例名称、ID、状态、IP地址、规格、镜像、创建时间、所属项目
  分页：每页20条，支持自定义
  排序：支持按各字段排序
  ```

- [ ] **搜索过滤**
  - 按名称模糊搜索
  - 按状态筛选（运行中、已停止、错误等）
  - 按IP地址搜索
  - 按创建时间范围过滤
  - 按规格类型筛选

- [ ] **批量操作**
  - 批量选择实例
  - 批量启动/停止/重启
  - 批量删除（需二次确认）
  - 批量导出数据

#### 3.2 实例操作
**功能描述**：对单个实例执行各种操作

**详细需求**：
- [ ] **基础操作**
  - 启动/停止/重启实例
  - 暂停/恢复实例
  - 锁定/解锁实例
  - 删除实例（需密码确认）

- [ ] **高级操作**
  - 重建实例（选择新镜像）
  - 调整规格（resize）
  - 创建快照
  - 挂载/卸载卷

- [ ] **实例详情**
  - 基本信息展示
  - 网络信息（所有IP地址）
  - 安全组信息
  - 卷挂载信息
  - 元数据信息
  - 控制台日志查看

#### 3.3 实例创建
**功能描述**：创建新的虚拟机实例

**详细需求**：
- [ ] **创建向导**
  ```
  步骤1：基本信息（名称、描述、数量）
  步骤2：镜像选择（支持搜索和筛选）
  步骤3：规格选择（CPU、内存、磁盘）
  步骤4：网络配置（选择网络、安全组）
  步骤5：高级选项（用户数据、密钥对）
  步骤6：确认创建
  ```

- [ ] **模板支持**
  - 保存创建配置为模板
  - 使用模板快速创建
  - 模板分享和管理

### 4. 卷管理模块

#### 4.1 卷列表管理
**功能描述**：存储卷的查看和管理

**详细需求**：
- [ ] **列表展示**
  ```
  字段：卷名称、ID、大小、状态、类型、挂载信息、创建时间
  状态标识：可用、使用中、创建中、错误等
  ```

- [ ] **卷操作**
  - 创建卷（名称、大小、类型、描述）
  - 删除卷（检查挂载状态）
  - 扩容卷（在线扩容支持）
  - 创建快照
  - 从快照创建卷

#### 4.2 卷挂载管理
**详细需求**：
- [ ] **挂载操作**
  - 选择实例挂载卷
  - 指定挂载点（/dev/vdb等）
  - 卸载卷

- [ ] **批量操作**
  - 批量创建卷
  - 批量删除未挂载的卷
  - 卷数据导出

### 5. 网络管理模块

#### 5.1 网络配置
**功能描述**：管理OpenStack网络资源

**详细需求**：
- [ ] **网络管理**
  - 查看网络列表
  - 创建网络（内部/外部网络）
  - 删除网络
  - 网络详情查看

- [ ] **子网管理**
  - 创建子网（CIDR、网关、DNS）
  - 删除子网
  - DHCP配置

- [ ] **路由器管理**
  - 创建路由器
  - 设置网关
  - 添加接口
  - 路由表查看

#### 5.2 安全组管理
**详细需求**：
- [ ] **安全组列表**
  - 查看所有安全组
  - 创建安全组
  - 删除安全组

- [ ] **安全规则**
  - 添加入站/出站规则
  - 规则类型：TCP、UDP、ICMP、自定义
  - 端口范围配置
  - 源地址配置

### 6. 快照管理模块

#### 6.1 快照操作
**功能描述**：实例和卷的快照管理

**详细需求**：
- [ ] **实例快照**
  - 创建实例快照
  - 从快照创建实例
  - 快照删除

- [ ] **卷快照**
  - 创建卷快照
  - 从快照恢复卷
  - 快照链查看

- [ ] **快照列表**
  - 快照类型区分（实例/卷）
  - 快照大小、创建时间
  - 批量删除过期快照

### 7. SSH连接管理模块

#### 7.1 SSH配置
**功能描述**：管理服务器SSH连接信息

**详细需求**：
- [ ] **连接配置**
  - 添加SSH连接（IP、端口、用户名、密钥）
  - 连接测试
  - 连接分组管理

- [ ] **在线终端**
  - Web SSH功能（WebSocket）
  - 多标签页支持
  - 终端历史记录

- [ ] **文件管理**
  - 简单的文件上传/下载
  - 文件编辑器

### 8. 监控与日志模块

#### 8.1 资源监控
**功能描述**：监控OpenStack资源状态

**详细需求**：
- [ ] **仪表盘**
  - 集群资源概览
  - 实例/卷/网络统计图表
  - 资源使用趋势

- [ ] **告警设置**
  - 资源使用率告警
  - 服务状态告警
  - 邮件/短信通知

#### 8.2 操作日志
**详细需求**：
- [ ] **日志记录**
  - 所有用户操作记录
  - 操作结果记录
  - 错误日志记录

- [ ] **日志查询**
  - 按用户查询
  - 按操作类型查询
  - 按时间范围查询
  - 日志导出功能

### 9. 系统设置模块

#### 9.1 系统配置
**功能描述**：平台基础设置

**详细需求**：
- [ ] **基础设置**
  - 系统名称和Logo
  - 时区设置
  - 语言设置

- [ ] **安全设置**
  - 登录策略配置
  - 密码策略设置
  - 会话超时设置

- [ ] **通知设置**
  - 邮件服务器配置
  - 短信网关配置
  - 通知模板管理

## 📊 数据库设计需求

### 核心表结构
```sql
-- 用户表
users (id, username, email, password_hash, role, status, created_at, updated_at)

-- 集群配置表  
openstack_clusters (id, name, description, auth_url, credentials, status, created_at)

-- 操作日志表
operation_logs (id, user_id, cluster_id, operation_type, resource_type, resource_id, result, details, created_at)

-- SSH连接表
ssh_connections (id, name, host, port, username, key_file, group_id, created_at)

-- 系统配置表
system_configs (key, value, description, updated_at)
```

## 🎯 实现优先级

### Phase 1: 基础框架（第1-2周）
1. 用户认证系统
2. 数据库设计和迁移
3. 基础页面布局

### Phase 2: 核心功能（第3-6周）
1. 集群管理
2. 实例管理（列表、详情、基础操作）
3. 卷管理（基础功能）

### Phase 3: 完善功能（第7-10周）
1. 网络管理
2. 快照管理  
3. SSH连接管理

### Phase 4: 高级功能（第11-14周）
1. 监控仪表盘
2. 批量操作
3. 操作日志和审计

### Phase 5: 优化完善（第15-16周）
1. 性能优化
2. UI/UX改进
3. 测试和文档

## ✅ 验收标准

每个功能模块必须满足：
- [ ] 功能完整实现
- [ ] 权限控制正确
- [ ] 错误处理完善
- [ ] 操作日志记录
- [ ] 用户界面友好
- [ ] 基础测试覆盖

## 📝 开发规范

- 每个功能点作为独立任务开发
- 先实现后端API，再开发前端界面  
- 每完成一个模块进行测试验收
- 及时更新文档和代码注释